---
title: "IdentificationOfDEgenes"
output: html_document
---

Code used to import and handle count data generated by the prepDE.py script. 
Initial testing of this code can be found in the later half of tuxedoRNAseq_markdownOut.Rmd




EdgeR
================================================================================================================================================================
================================================================================================================================================================

```{r}
rm(list=ls())

library(edgeR)

countData <- as.matrix(read.csv("~/hisatAnalysis/stringtie_prepDE_output/stringtiePrepDE_geneCountMatrix.csv", row.names="gene_id"))
group <- factor(c(rep("A",3),rep("B",3),rep("C",3),rep("D",3),rep("E",3),rep("F",3)))
sampleInformation <- read.csv("~/hisatAnalysis/ballgownPhenodata.csv")

# Filter genes not expressed:
y <- DGEList(counts = countData, group=group)
keep <- rowSums(cpm(y)>2) >= 3
table(keep)
y <- y[keep, , keep.lib.sizes=FALSE]
y <- calcNormFactors(y)
# The calcNormFactors function normalizes for RNA composition by finding a set of scaling factors for the library sizes that minimize the log-fold changes between the samples for most genes.
## 

# Perform quasi-likelihood F-tests: (These are noted in the user guide to be the correct test to use as it uses stricter error rate control by accounting for the uncertainty in dispersion estimates)
## Refer to EdgeR user's guide Chapter 3 (Specific experimental designs)
## GLM approach (requires a design matrix, allows more general comparisons to be made)

design <- model.matrix(~0+group, data=y$samples)
colnames(design) <- levels(y$samples$group)
design

# y <- estimateGLMCommonDisp(y,design)
# y <- estimateGLMTrendedDisp(y,design)
# y <- estimateGLMTagwiseDisp(y,design)
# An alternative to using the three lines above is this single line (recommended)
y <- estimateDisp(y, design)
fit <- glmQLFit(y, design)

# Plot dispersion:
plotBCV(y)
pdf("/home/mcity599/Documents/tuxedoRNASeq/qualityPlots/BCV.pdf") # starts writing a PDF to file
plotBCV(y)                 # makes the actual plot
           # closes the PDF file
while (!is.null(dev.list()))  
  dev.off()

# Run tests:
qlf.BvsA <- glmQLFTest(fit, contrast=my.contrasts[,"BvsA"])
topTags(qlf.BvsA)
qlf.DvsC <- glmQLFTest(fit, contrast=my.contrasts[,"DvsC"])
topTags(qlf.DvsC)
qlf.FvsE <- glmQLFTest(fit, contrast=my.contrasts[,"FvsE"])
topTags(qlf.FvsE)
```


```{r}


plotBCV(y)
pdf("/home/mcity599/Documents/tuxedoRNASeq/qualityPlots/BCV.pdf") # starts writing a PDF to file
plotBCV(y)                 # makes the actual plot
           # closes the PDF file
while (!is.null(dev.list()))  
  dev.off()


```

